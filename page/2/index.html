<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="简体中文">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="张奇怪的blog">
<meta property="og:url" content="https://zhanghongtong.github.io/page/2/index.html">
<meta property="og:site_name" content="张奇怪的blog">
<meta property="og:locale" content="简体中文">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="张奇怪的blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zhanghongtong.github.io/page/2/"/>





  <title>张奇怪的blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="简体中文">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">张奇怪的blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhanghongtong.github.io/2018/05/15/可能是最好的ss-panel部署教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张奇怪">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张奇怪的blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/15/可能是最好的ss-panel部署教程/" itemprop="url">可能是最好的ss-panel部署教程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-15T15:12:33+08:00">
                2018-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/服务器/" itemprop="url" rel="index">
                    <span itemprop="name">服务器</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="可能是最好的-ss-panel-部署教程"><a href="#可能是最好的-ss-panel-部署教程" class="headerlink" title="可能是最好的 ss-panel 部署教程"></a><a href="https://blessing.studio/build-shadowsocks-sharing-site-with-ss-panel/" target="_blank" rel="noopener">可能是最好的 ss-panel 部署教程</a></h1><p>本文转载于：<a href="https://blessing.studio/build-shadowsocks-sharing-site-with-ss-panel/" target="_blank" rel="noopener">https://blessing.studio/build-shadowsocks-sharing-site-with-ss-panel/</a></p>
<p>今天折腾了好久 ss-panel，期间遇到了一些奇奇怪怪的问题，但是网上都没有好的解决方法。网上那么多教程有些是写得笼统，有些还是瞎复制的。由此萌生了想要写一篇配置 ss-panel 和 ss-manyuser 的教程，希望能够帮到需要的人。</p>
<p>注意，本教程 <strong>不是</strong> 图文并茂的面向小白的教程，窝希望你能够有足够的 Linux 操作经验再来看这篇教程。至少你需要熟悉 ssh 连接，熟悉 Web 环境的配置，最好可以看得懂一些代码。</p>
<h2 id="一、安装并配置-ss-panel"><a href="#一、安装并配置-ss-panel" class="headerlink" title="一、安装并配置 ss-panel"></a>一、安装并配置 ss-panel</h2><p>本教程打算先配置好前端，当然你想要先配置后端可以拉下去。</p>
<h3 id="0x01-环境要求"><a href="#0x01-环境要求" class="headerlink" title="0x01 环境要求"></a>0x01 环境要求</h3><p>作为前端的 ss-panel 是使用 PHP 编写的网页应用程序，它对你的主机运行环境有一定的要求。</p>
<ul>
<li>PHP 5.6 或更高</li>
<li>MySQL 5.5 或更高</li>
<li>支持 URL 重写的 Web 服务器（Nginx / Apache 均可）</li>
</ul>
<p>本教程所使用的环境是 NGINX + PHP 7 + MariaDB 10。当然其他主流 LNMP/LAMP 架构都可以（个人推荐使用 <a href="https://oneinstack.com/" target="_blank" rel="noopener">OneinStack</a>），确保你的站点可以访问后就继续吧。</p>
<p>什么？你不知道上面说的那些东西是什么？那你为什么不问问<a href="https://www.google.com/" target="_blank" rel="noopener">神奇海螺</a>呢？</p>
<hr>
<p><strong>注意</strong>，接下来的操作大部分都是在【目标服务器】的 shell 中进行的。继续阅读之前，你需要通过 SSH 等工具连接至你的服务器，它一般长这样：</p>
<p><a href="https://img.blessing.studio/images/2017/02/18/QQ20170218173516.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2017/02/18/QQ20170218173516.png" alt="shell example"></a></p>
<p>如果你不晓得这是什么，神奇海螺……以下略。</p>
<h3 id="0x02-下载-ss-panel-源码"><a href="#0x02-下载-ss-panel-源码" class="headerlink" title="0x02 下载 ss-panel 源码"></a>0x02 下载 ss-panel 源码</h3><p>ss-panel 的 GitHub 项目地址：<a href="https://github.com/orvice/ss-panel" target="_blank" rel="noopener">orvice/ss-panel</a></p>
<p>使用 <code>cd</code> 进入你站点的 web 根目录，从 git 上 clone 源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 最前面的美元符号是命令提示符，别把这个给一起输进去了</span><br><span class="line">$ git clone https://github.com/orvice/ss-panel.git</span><br></pre></td></tr></table></figure>
<p>当然你也可以下载源码再用 SCP/FPS 传到服务器上去。</p>
<p>注意源码下载完成后的目录结构，<strong>请务必保证</strong> <code>/public</code> 目录在站点的根目录下。你可以使用 <code>$ mv ss-panel/{.,}* ./</code> 命令将子目录的内容移动到当前目录来。正确的目录结构应该类似于这样：</p>
<p><a href="https://img.blessing.studio/images/2017/02/18/QQ20170218174949.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2017/02/18/QQ20170218174949.png" alt="directory structure example"></a></p>
<h3 id="0x03-配置-ss-panel"><a href="#0x03-配置-ss-panel" class="headerlink" title="0x03 配置 ss-panel"></a>0x03 配置 ss-panel</h3><p>执行完上面的步骤之后，你兴高采烈地访问了你的站点，却得到了无情的 403 Forbidden —— 站点根目录下竟然没有 index.php！</p>
<p>好吧其实没什么好奇怪的，大部分 MVC 框架都将 <code>index.php</code> 的入口文件放到其他子目录下了，这样做是为了保护根目录下的配置文件等可能会导致信息泄露的敏感文件无法被访问。</p>
<p>接下来请按照 <a href="https://sspanel.xyz/docs/intro/installation#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">官方文档的说明</a> 正确配置你的 Web 服务器。正确配置后的 NGINX 配置应该长这样：</p>
<p><a href="https://img.blessing.studio/images/2017/02/18/QQ20170218180726.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2017/02/18/QQ20170218180726.png" alt="nginx configuration sample"></a></p>
<p>编辑完后重载你的 Web 服务器，然后访问你的站点……于是你得到了一个 500 Internal Server Error（如果你没开启 <code>display_errors</code> 可能看不到详细报错）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Warning: require(/home/wwwroot/ss.prinzeugen.net/vendor/autoload.php): failed to open stream: No such file or directory in /home/wwwroot/ss.prinzeugen.net/bootstrap.php on line 18</span><br><span class="line"></span><br><span class="line">Fatal error: require(): Failed opening required &apos;/home/wwwroot/ss.prinzeugen.net/vendor/autoload.php&apos; (include_path=&apos;.:/usr/local/php/lib/php&apos;) in /home/wwwroot/ss.prinzeugen.net/bootstrap.php on line 18</span><br></pre></td></tr></table></figure>
<p>这是我们还未安装 ss-panel 所需的依赖库导致的。遂安装之：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sS https://getcomposer.org/installer | php</span><br><span class="line">$ php composer.phar install</span><br></pre></td></tr></table></figure>
<p><a href="https://img.blessing.studio/images/2017/02/18/QQ20170218181624.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2017/02/18/QQ20170218181624.png" alt="installing dependencies with composer"></a></p>
<p>等待它安装完毕后接着进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp .env.example .env</span><br></pre></td></tr></table></figure>
<p>将 <code>.env.example</code> 复制一份重命名为 <code>.env</code>，自行修改其中的数据库等信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># database 数据库配置</span><br><span class="line">db_driver = &apos;mysql&apos;</span><br><span class="line">db_host = &apos;localhost&apos;</span><br><span class="line">db_port = &apos;3306&apos;</span><br><span class="line">db_database = &apos;ss-panel&apos;</span><br><span class="line">db_username = &apos;ss-panel&apos;</span><br><span class="line">db_password = &apos;secret&apos;</span><br><span class="line">db_charset = &apos;utf8&apos;</span><br><span class="line">db_collation = &apos;utf8_general_ci&apos;</span><br><span class="line">db_prefix = &apos;&apos;</span><br></pre></td></tr></table></figure>
<p>数据库的创建我就不多说了，建站的一般都玩过数据库吧？将根目录下的 <code>db.sql</code> 导入到数据库中即可。其他配置自行修改。</p>
<p><a href="https://img.blessing.studio/images/2017/02/18/QQ20170218183004.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2017/02/18/QQ20170218183004.png" alt="importing tables"></a></p>
<p>你还需要修改 <code>.env</code> 中的 <code>muKey</code> 字段，修改为任意字符串（最好只包含 ASCII 字符），下面配置后端的时候我们需要使用到这个 <code>muKey</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">muKey = &apos;api_key_just_for_test&apos;</span><br></pre></td></tr></table></figure>
<p>接下来，确保 <code>storage</code> 目录可写入（否则 Smarty 会报错）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chown -R www storage</span><br></pre></td></tr></table></figure>
<p>现在访问你的站点，就可以看到 ss-panel 的首页啦：</p>
<p><a href="https://ooo.0o0.ooo/2017/02/18/58a82108b285e.png" target="_blank" rel="noopener"><img src="https://ooo.0o0.ooo/2017/02/18/58a82108b285e.png" alt="landing page"></a></p>
<h3 id="0x03-进入-ss-panel-后台"><a href="#0x03-进入-ss-panel-后台" class="headerlink" title="0x03 进入 ss-panel 后台"></a>0x03 进入 ss-panel 后台</h3><p>现在访问 <a href="http://your-domain/admin" target="_blank" rel="noopener">http://your-domain/admin</a> 就可以进入 ss-panel 后台了。</p>
<p>不过细心的你可能会注意到，刚才导入数据表的时候，user 表并没有添加记录，那要咋进管理后台呢？当然你可以在数据库中手动加一条记录，不过作者已经提供了一个更方便的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php xcat createAdmin</span><br></pre></td></tr></table></figure>
<p>在站点根目录下运行，根据提示即可创建管理员账号 <del>（这个文字对齐真鸡儿 shi）</del>：</p>
<p><a href="https://img.blessing.studio/images/2017/02/18/QQ20170218184049.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2017/02/18/QQ20170218184049.png" alt="creating admin account"></a></p>
<p>使用刚才填写的邮箱和密码进入后台：</p>
<p><a href="https://ooo.0o0.ooo/2017/02/18/58a825580f6c3.png" target="_blank" rel="noopener"><img src="https://ooo.0o0.ooo/2017/02/18/58a825580f6c3.png" alt="ss-panel dashboard screenshot"></a></p>
<p>到这里，作为前端的 ss-panel 就已经配置完成了。下面开始部署作为后端的 <code>shadowsocks-manyuser</code>。</p>
<hr>
<h2 id="二、部署并配置-shadowsocks-manyuser"><a href="#二、部署并配置-shadowsocks-manyuser" class="headerlink" title="二、部署并配置 shadowsocks-manyuser"></a>二、部署并配置 shadowsocks-manyuser</h2><p>在本篇教程中我们使用 <a href="https://github.com/fsgmhoward/shadowsocks-py-mu" target="_blank" rel="noopener">fsgmhoward/shadowsocks-py-mu</a> 这个版本的后端。不同于这篇教程原先推荐的 <a href="https://github.com/mengskysama/shadowsocks-rm/tree/manyuser" target="_blank" rel="noopener">@mengskysama</a> 版本，这个后端支持使用 MultiUser API 与前端的 ss-panel 进行用户信息交互。</p>
<p>这个 API 的官方介绍在<a href="https://sspanel.xyz/docs/muapi" target="_blank" rel="noopener">这里</a>。简单来讲，如果你通过 API 来与前端通信，你就不需要修改后端的数据库配置了，并且可以使用「自定义加密」、「流量记录」等高级功能。下面我<strong>只介绍</strong>使用 API 的方法，另外那个比较麻烦的方法可以在<a href="https://github.com/fsgmhoward/shadowsocks-py-mu#install-instruction-for-database-user" target="_blank" rel="noopener">这里</a>查看。</p>
<h3 id="0x01-安装-shadowsocks-manyuser"><a href="#0x01-安装-shadowsocks-manyuser" class="headerlink" title="0x01 安装 shadowsocks-manyuser"></a>0x01 安装 shadowsocks-manyuser</h3><p>先将代码 clone 到本地：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/fsgmhoward/shadowsocks-py-mu.git</span><br></pre></td></tr></table></figure>
<p>源码 clone 后，你的目录结构应该是这样的：</p>
<p><a href="https://img.blessing.studio/images/2017/02/18/QQ20170218200629.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2017/02/18/QQ20170218200629.png" alt="directory structure ss mu"></a></p>
<p>其中的 shadowsocks 子目录才是我们需要的，外面的是 <code>setup.py</code> 的相关文件。</p>
<h3 id="0x02-配置-shadowsocks-manyuser"><a href="#0x02-配置-shadowsocks-manyuser" class="headerlink" title="0x02 配置 shadowsocks-manyuser"></a>0x02 配置 shadowsocks-manyuser</h3><p>进入 <code>shadowsocks</code> 目录，将 <code>config_example.py</code> 复制一份到 <code>config.py</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp config_example.py config.py</span><br></pre></td></tr></table></figure>
<p>修改其中第 15 行和第 29~31 行的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 启用 MultiUser API</span><br><span class="line">API_ENABLED = True</span><br><span class="line"></span><br><span class="line"># 就是在你的站点地址后面加个 /mu</span><br><span class="line">API_URL = &apos;http://ss.prinzeugen.net/mu&apos;</span><br><span class="line"># 还记得上面在 .env 中填写的 muKey 吗？把它填在这里</span><br><span class="line">API_PASS = &apos;api_key_just_for_test&apos;</span><br></pre></td></tr></table></figure>
<p>由于我们选择使用 Mu API 来与前端通信，所以我们<strong>不需要</strong>修改 <code>config.py</code> 中任何关于数据库的配置。</p>
<p>好了，现在可以试着运行一下 <code>$ python servers.py</code> 了（注意，是 <strong>servers.py</strong> 而不是 <strong>server.py</strong>）。如果没错的话，应该可以看到这样的输出：</p>
<p><a href="https://img.blessing.studio/images/2017/02/18/QQ20170218203217.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2017/02/18/QQ20170218203217.png" alt="running successfully"></a></p>
<p>其中 <code>P[XXX]</code> 表示用户端口，<code>M[XXX]</code> 表示加密方式，<code>E[XXX]</code> 表示用户的邮箱地址。这些都会随着 ss-panel 前端中用户配置的改变而实时变化。</p>
<h3 id="0x03-常见错误-FAQ"><a href="#0x03-常见错误-FAQ" class="headerlink" title="0x03 常见错误 FAQ"></a>0x03 常见错误 FAQ</h3><p>连接上 shadowsocks 试试看能不能翻墙了？<strong>八成不能</strong>。</p>
<p>虽然你成功的把 servers.py 跑起来了，但还可能有各种神奇的错误阻止你翻出伟大的墙。</p>
<p>首先国际惯例查看连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -anp | grep 你的端口</span><br></pre></td></tr></table></figure>
<p>正常的话，应该是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 0.0.0.0:62111            0.0.0.0:*               LISTEN      32083/python</span><br><span class="line">tcp        0      0 162.233.122.111:62111    115.233.233.140:47177   TIME_WAIT   -            </span><br><span class="line">tcp        0      0 162.233.122.111:62111    115.233.233.140:47161   TIME_WAIT   -            </span><br><span class="line">tcp        0      0 162.233.122.111:62111    115.233.233.140:47160   TIME_WAIT   -            </span><br><span class="line">tcp        0      0 162.233.122.111:62111    115.233.233.140:47157   TIME_WAIT   -</span><br></pre></td></tr></table></figure>
<p>如果没有来自你的 IP 的 TCP 连接的话，那八成就是防火墙的锅了，执行 iptables 放行你的端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ iptables -I INPUT -p tcp -m tcp --dport 你的端口 -j ACCEPT</span><br><span class="line">$ iptables-save</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ss-panel 新注册的用户所分配的端口均为其 id-1 的用户的端口号 + 1。比如说你把 admin 用户（uid 为1）的端口改为 12450（ss-panel 中不能改，去数据库改），那么后面注册的新用户的端口就会是 12451, 12452 这样递增的。</p>
</blockquote>
<p>所以如果你要开放注册，就要这样配置你的 iptables：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 注意是半角冒号，意为允许 12450 及以上的端口</span><br><span class="line"># 也可以指定 12450:15550 这样的范围</span><br><span class="line">$ iptables -I INPUT -p tcp -m tcp --dport 12450: -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>现在再连接 shadowsocks 就应该可以看到 TCP 连接信息了。并且你可以在 ss-mu 后端的输出信息中看到详细的连接日志：</p>
<p><a href="https://ooo.0o0.ooo/2017/02/18/58a8420faee8c.png" target="_blank" rel="noopener"><img src="https://ooo.0o0.ooo/2017/02/18/58a8420faee8c.png" alt="connection log"></a></p>
<p>日志格式的详细介绍在这里：<a href="https://github.com/fsgmhoward/shadowsocks-py-mu#explanation-of-the-log-output" target="_blank" rel="noopener">Explanation of the log output</a>。</p>
<h2 id="三、配置-ss-manyuser-守护进程以及多节点配置"><a href="#三、配置-ss-manyuser-守护进程以及多节点配置" class="headerlink" title="三、配置 ss-manyuser 守护进程以及多节点配置"></a>三、配置 ss-manyuser 守护进程以及多节点配置</h2><h3 id="0x01-使用-supervisor-监控-ss-manyuser-运行"><a href="#0x01-使用-supervisor-监控-ss-manyuser-运行" class="headerlink" title="0x01 使用 supervisor 监控 ss-manyuser 运行"></a>0x01 使用 supervisor 监控 ss-manyuser 运行</h3><p>如果你只是想让 ss-manyuser 在后台运行的话，可以参考我写的<a href="https://prinzeugen.net/linux-tips-how-to-run-program-on-the-background" target="_blank" rel="noopener">这篇文章</a>。</p>
<p>安装 supervisor （用的是上面安装过的 pip）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 先安装 pip 包管理器</span><br><span class="line">$ sudo apt-get install python-pip  # For Debian/Ubuntu</span><br><span class="line">$ sudo yum install python-pip      # For CentOS</span><br><span class="line"></span><br><span class="line">$ pip install supervisor</span><br></pre></td></tr></table></figure>
<p>创建 supervisor 配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 输出至 supervisor 的默认配置路径</span><br><span class="line">$ echo_supervisord_conf &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>运行 supervisor 服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ supervisord</span><br></pre></td></tr></table></figure>
<p>配置 supervisor 以监控 ss-manyuser 运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>在文件尾部（当然也可以<a href="http://supervisord.org/configuration.html" target="_blank" rel="noopener">新建配置文件</a>，不过这样比较方便）添加如下内容并酌情修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[program:ss-manyuser]</span><br><span class="line">command = python /root/shadowsocks-py-mu/shadowsocks/servers.py</span><br><span class="line">user = root</span><br><span class="line">autostart = true</span><br><span class="line">autorestart = true</span><br></pre></td></tr></table></figure>
<p>其中 command 里的目录请自行修改为你的 <code>servers.py</code> 所在的绝对路径。</p>
<p>重启 supervisor 服务以加载配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ killall -HUP supervisord</span><br></pre></td></tr></table></figure>
<p>查看 shadowsocks-manyuser 是否已经运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep servers.py</span><br><span class="line">root       952   739  0 15:40 ?        00:00:00 python /root/shadowsocks-rm/shadowsocks/servers.py</span><br></pre></td></tr></table></figure>
<p>可以通过以下命令管理 shadowsock-manyuser 的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ supervisorctl &#123;start|stop|restart&#125; ss-manyuser</span><br></pre></td></tr></table></figure>
<h3 id="0x02-ss-panel-的多节点配置"><a href="#0x02-ss-panel-的多节点配置" class="headerlink" title="0x02 ss-panel 的多节点配置"></a>0x02 ss-panel 的多节点配置</h3><p>其实多节点也没咋玄乎，说白了就是多个后端共用一个前端而已。而且我们的后端是使用 Mu API 来与前端进行交互的，所以多节点的配置就更简单了：只要把所有后端的 <code>config.py</code> 中的 <code>API_URL</code> 和 <code>API_PASS</code> 都改成一样即可（记得 <code>API_ENABLED = True</code>）。</p>
<h2 id="四、写在后面"><a href="#四、写在后面" class="headerlink" title="四、写在后面"></a>四、写在后面</h2><p>其他可用的前端：</p>
<ul>
<li><a href="https://github.com/esdeathlove/ss-panel-v3-mod" target="_blank" rel="noopener">esdeathlove/ss-panel-v3-mod</a>，修改版的 ss-panel，修改了蛮多东西的，有兴趣的朋友可以去看看，他那边安装说明都写得很详细了；</li>
<li><a href="https://github.com/sendya/shadowsocks-panel" target="_blank" rel="noopener">sendya/shadowsocks-panel</a>，另外一个全新的 ss-manyuser 前端，有用户等级、套餐、支付等功能，不支持使用 Mu API，部署教程在<a href="https://github.com/sendya/shadowsocks-panel/wiki/Shadowsocks-Panel-%E9%9D%A2%E6%9D%BF%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B" target="_blank" rel="noopener">这里</a>。</li>
</ul>
<p>其他可用的后端：</p>
<ul>
<li><a href="https://github.com/catpie/ss-go-mu" target="_blank" rel="noopener">shadowsocks-go mu</a>，Go 语言实现，性能比 Python 版好，也支持 Mu API；</li>
<li><a href="https://github.com/shadowsocksr/shadowsocksr" target="_blank" rel="noopener">shadowsocksR manyuser</a> SSR 版本，见仁见智。</li>
</ul>
<p>这几个后端的部署方法大同小异，我这里就不再赘述了。</p>
<h4 id="文章更新日志"><a href="#文章更新日志" class="headerlink" title="文章更新日志"></a>文章更新日志</h4><ul>
<li>2017-02-18</li>
<li>根据评论区推荐将后端由 <a href="https://github.com/mengskysama/shadowsocks-rm/tree/manyuser" target="_blank" rel="noopener">mengskysama/shadowsocks-rm/manyuser</a> 切换至 <a href="https://github.com/fsgmhoward/shadowsocks-py-mu" target="_blank" rel="noopener">fsgmhoward/shadowsocks-py-mu</a>；</li>
<li>所有后端配置均改用 <a href="https://sspanel.xyz/docs/muapi/v2" target="_blank" rel="noopener">Mu API v2</a> 的方法；</li>
<li>使用了更加严谨的文法。</li>
</ul>
<hr>
<p><a href="https://img.blessing.studio/images/2017/02/18/QQ20170218213554.png" target="_blank" rel="noopener"><img src="https://img.blessing.studio/images/2017/02/18/QQ20170218213554.png" alt="success google"></a></p>
<p>至此，你已完成对 ss-panel 的部署。叫上小伙伴们一起享受自由的互联网吧 ;)</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhanghongtong.github.io/2018/05/14/go语言获取文件名、后缀/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张奇怪">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张奇怪的blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/14/go语言获取文件名、后缀/" itemprop="url">go语言获取文件名、后缀</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-14T15:35:07+08:00">
                2018-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">//http://my.oschina.net/itfanr/blog/373983</span><br><span class="line">package main</span><br><span class="line"> </span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;path&quot;</span><br><span class="line">    &quot;strings&quot;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">func main() &#123;</span><br><span class="line">    fullFilename := &quot;/Users/itfanr/Documents/test.txt&quot;</span><br><span class="line">    fmt.Println(&quot;fullFilename =&quot;, fullFilename)</span><br><span class="line">    var filenameWithSuffix string</span><br><span class="line">    filenameWithSuffix = path.Base(fullFilename) //获取文件名带后缀</span><br><span class="line">    fmt.Println(&quot;filenameWithSuffix =&quot;, filenameWithSuffix)</span><br><span class="line">    var fileSuffix string</span><br><span class="line">    fileSuffix = path.Ext(filenameWithSuffix) //获取文件后缀</span><br><span class="line">    fmt.Println(&quot;fileSuffix =&quot;, fileSuffix)</span><br><span class="line"> </span><br><span class="line">    var filenameOnly string</span><br><span class="line">    filenameOnly = strings.TrimSuffix(filenameWithSuffix, fileSuffix)//获取文件名</span><br><span class="line">    fmt.Println(&quot;filenameOnly =&quot;, filenameOnly)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhanghongtong.github.io/2018/05/14/GOLANG随机数生成方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张奇怪">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张奇怪的blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/14/GOLANG随机数生成方法/" itemprop="url">GOLANG随机数生成方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-14T15:31:24+08:00">
                2018-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用rand包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;math/rand&quot;</span><br><span class="line">)</span><br><span class="line">func main() &#123;</span><br><span class="line">    for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">        fmt.Println(rand.Intn(100)) //返回[0,100)的随机整数</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样使用是可以产生随机数，但是程序重启后，产生的随机数和上次一样。是因为程序使用了相同的种子 1。可以使用rand.Seed(seed)来设置一个不同的种子值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;math/rand&quot;</span><br><span class="line">    &quot;time&quot;</span><br><span class="line">)</span><br><span class="line">func main() &#123;</span><br><span class="line">    rand.Seed(time.Now().UnixNano()) //利用当前时间的UNIX时间戳初始化rand包</span><br><span class="line">    for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">        x := rand.Intn(100)</span><br><span class="line">        fmt.Println(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>产生指定数字范围内的随机数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;math/rand&quot;</span><br><span class="line">    &quot;time&quot;</span><br><span class="line">)</span><br><span class="line">func main() &#123;</span><br><span class="line">    for i := 0; i &lt; 10; i++ &#123;</span><br><span class="line">        x := randInt(100，999)</span><br><span class="line">        fmt.Println(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func randInt(min int , max int) int &#123;</span><br><span class="line">	rand.Seed(time.Now().UnixNano())</span><br><span class="line">	return min + rand.Intn(max-min)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhanghongtong.github.io/2018/05/14/Golang：使用HTML模板发送邮件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张奇怪">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张奇怪的blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/14/Golang：使用HTML模板发送邮件/" itemprop="url">Golang：使用HTML模板发送邮件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-14T15:28:48+08:00">
                2018-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>创建HTML模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span><br><span class="line">&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span><br><span class="line">　&lt;head&gt;</span><br><span class="line">    　　&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;</span><br><span class="line">    　　&lt;title&gt;&#123;&#123;.SUBJECT&#125;&#125;&#125;&lt;/title&gt;</span><br><span class="line">    　　&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;/&gt;</span><br><span class="line">    　&lt;/head&gt;</span><br><span class="line">    &lt;body style=&quot;margin: 0; padding: 0;&quot;&gt;</span><br><span class="line">    	&lt;img style=&apos;float:left;margin-bottom:20px&apos; src=&apos;https://initiranking-system.oss-cn-hangzhou.aliyuncs.com/logo.png&apos;&gt;</span><br><span class="line">       &lt;table style=&apos;&apos; border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">             &lt;td style=&apos;font-size:18px&apos;&gt; Hi, &#123;&#123;.TO&#125;&#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">              &lt;tr&gt;</span><br><span class="line">                  &lt;td style=&apos;color:#ccc&apos;&gt; your code is &#123;&#123;.CODE&#125;&#125;&lt;/td&gt;</span><br><span class="line">              &lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">      &lt;div style=&apos;margin-top:20px&apos;&gt;</span><br><span class="line">          &lt;div style=&apos;display: inline-block;</span><br><span class="line">                              width: 30px;</span><br><span class="line">                              height: 5px;</span><br><span class="line">                              border-top:1px #000 solid&apos;&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;p style=&apos;display: inline-block;&apos;&gt;</span><br><span class="line">              Nodress www.noderess.com</span><br><span class="line">          &lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>读取模板并导入数据</p>
<p>首先通过解析 html 来创建一个模板，然后把它存储在一个变量 t 中（稍后再用）。然后声明一个 bytes.Buffer 用于保存 email 的 主题、header 和正文（自定义 html）。我发现使用 bytes.Buffer 类型比在其他在线解决方案中使用的其他类型更加灵活。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">func SendVerCode() error &#123;</span><br><span class="line">	subject := &quot;Nodress Verification Code&quot;	//邮件主题</span><br><span class="line">	to := &quot;test@qq.com&quot;	//发送目标</span><br><span class="line">	</span><br><span class="line">	//由服务商提供</span><br><span class="line">	host := &quot;smtpdm.aliyun.com:25&quot;</span><br><span class="line">	user := &quot;service@sendemail.nodress67.com&quot;</span><br><span class="line">	password := &quot;NoDress6767&quot;</span><br><span class="line"></span><br><span class="line">	//自己重写的的stmp的登录，详见《Go语言使用SMTP的发送邮件报错unencrypted connection的解决方案》</span><br><span class="line">	auth := LoginAuth(user, password)	</span><br><span class="line"></span><br><span class="line">	//读取HTML</span><br><span class="line">	t, err := template.ParseFiles(&quot;view/emailTemplate/verificationCode.html&quot;)</span><br><span class="line">	if err != nil&#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//声明一个 bytes.Buffer 用于保存 email 的 主题、header 和正文（自定义 html）</span><br><span class="line">	var b bytes.Buffer</span><br><span class="line">	headers := &quot;Content-Type: text/html; charset=UTF-8&quot;</span><br><span class="line">	b.Write([]byte(&quot;To: &quot; + to + &quot;\r\nFrom: &quot; + user + &quot;\r\nSubject: &quot; + subject + &quot;\r\n&quot; + headers + &quot;\r\n\r\n&quot;))</span><br><span class="line"></span><br><span class="line">	t.Execute(&amp;b, struct &#123;</span><br><span class="line">		SUBJECT string</span><br><span class="line">		TO string</span><br><span class="line">		CODE string</span><br><span class="line">	&#125;&#123;</span><br><span class="line">		SUBJECT:subject,</span><br><span class="line">		TO:to,</span><br><span class="line">		CODE:code,</span><br><span class="line">	&#125;)</span><br><span class="line">	send_to := strings.Split(to, &quot;;&quot;)</span><br><span class="line">	</span><br><span class="line">	//发送邮件</span><br><span class="line">	err = smtp.SendMail(host, auth, user, send_to, b.Bytes())</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		return err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhanghongtong.github.io/2018/05/14/Go语言使用SMTP的发送邮件报错unencrypted connection的解决方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张奇怪">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张奇怪的blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/14/Go语言使用SMTP的发送邮件报错unencrypted connection的解决方案/" itemprop="url">Go语言使用SMTP的发送邮件报错unencrypted connection的解决方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-14T15:24:25+08:00">
                2018-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转自：<a href="http://www.kuqin.com/shuoit/20140303/338368.html" target="_blank" rel="noopener">http://www.kuqin.com/shuoit/20140303/338368.html</a></p>
<p>山坡网需要能够每周给注册用户发送一封名为“本周最热书籍”的邮件，而之前一直使用的腾讯企业邮箱罢工了，提示说发送请求太多太密集。</p>
<p>一番寻找之后发现了大家口碑不错的搜狐SendCloud服务，看了看文档，价格实惠用起来也方便，于是准备使用它做邮件发送服务器。按照文档的配置一步步走下来发现在发送邮件的时候竟然出错了，错误提示是“unencrypted connection”，奇怪了。</p>
<p>由于用的是smtp包的PLAIN认证方式，所以打开源代码看了看（SublimeText3+GoSublime里ctrl+. ctrl+a输入包名和结构名直接查看源代码，谁用谁喜欢），发现这里要求使用加密连接，否则就会出上述错误。恩，也能理解，毕竟这里明文发送密码了。关键代码如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auth := smtp.PlainAuth(&quot;&quot;, Config.Username, Config.Password, Config.Host)</span><br><span class="line">smtp.SendMail(addr, auth, from, to, []byte(self.String()))</span><br></pre></td></tr></table></figure>
<p>问题明白之后思路也出来了，自己写一个不需要加密链接的PLAIN认证就好了。直接把标准库中PLAIN的实现拿过来，删除其中需要加密函数的部分，照着写了一个LoginAuth。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package sendMail</span><br><span class="line"></span><br><span class="line">import &quot;net/smtp&quot;</span><br><span class="line"></span><br><span class="line">type loginAuth struct &#123;</span><br><span class="line">	username, password string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func LoginAuth(username, password string) smtp.Auth &#123;</span><br><span class="line">	return &amp;loginAuth&#123;username, password&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (a *loginAuth) Start(server *smtp.ServerInfo) (string, []byte, error) &#123;</span><br><span class="line">	return &quot;LOGIN&quot;, []byte(a.username), nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (a *loginAuth) Next(fromServer []byte, more bool) ([]byte, error) &#123;</span><br><span class="line">	if more &#123;</span><br><span class="line">		switch string(fromServer) &#123;</span><br><span class="line">		case &quot;Username:&quot;:</span><br><span class="line">			return []byte(a.username), nil</span><br><span class="line">		case &quot;Password:&quot;:</span><br><span class="line">			return []byte(a.password), nil</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return nil, nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把发送邮件的代码改成下面这样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auth := LoginAuth(user, password)</span><br><span class="line">smtp.SendMail(addr, auth, from, to, []byte(self.String()))</span><br></pre></td></tr></table></figure>
<p>搞定</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhanghongtong.github.io/2018/05/14/go-ini中文手册/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张奇怪">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张奇怪的blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/14/go-ini中文手册/" itemprop="url">go-ini手册</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-14T14:55:12+08:00">
                2018-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本包提供了 Go 语言中读写 INI 文件的功能。</p>
<h2 id="功能特性"><a href="#功能特性" class="headerlink" title="功能特性"></a>功能特性</h2><ul>
<li>支持覆盖加载多个数据源（<code>[]byte</code>、文件和 <code>io.ReadCloser</code>）</li>
<li>支持递归读取键值</li>
<li>支持读取父子分区</li>
<li>支持读取自增键名</li>
<li>支持读取多行的键值</li>
<li>支持大量辅助方法</li>
<li>支持在读取时直接转换为 Go 语言类型</li>
<li>支持读取和 <strong>写入</strong> 分区和键的注释</li>
<li>轻松操作分区、键值和注释</li>
<li>在保存文件时分区和键值会保持原有的顺序</li>
</ul>
<h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><p>使用一个特定版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get gopkg.in/ini.v1</span><br></pre></td></tr></table></figure>
<p>使用最新版：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/go-ini/ini</span><br></pre></td></tr></table></figure>
<p>如需更新请添加 <code>-u</code> 选项。</p>
<h3 id="测试安装"><a href="#测试安装" class="headerlink" title="测试安装"></a>测试安装</h3><p>如果您想要在自己的机器上运行测试，请使用 <code>-t</code> 标记：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -t gopkg.in/ini.v1</span><br></pre></td></tr></table></figure>
<p>如需更新请添加 <code>-u</code> 选项。</p>
<h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><h3 id="从数据源加载"><a href="#从数据源加载" class="headerlink" title="从数据源加载"></a>从数据源加载</h3><p>一个 <strong>数据源</strong> 可以是 <code>[]byte</code> 类型的原始数据，<code>string</code> 类型的文件路径或 <code>io.ReadCloser</code>。您可以加载 <strong>任意多个</strong> 数据源。如果您传递其它类型的数据源，则会直接返回错误。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfg, err := ini.Load([]<span class="keyword">byte</span>(<span class="string">"raw data"</span>), <span class="string">"filename"</span>, ioutil.NopCloser(bytes.NewReader([]<span class="keyword">byte</span>(<span class="string">"some other data"</span>))))</span><br></pre></td></tr></table></figure>
<p>或者从一个空白的文件开始：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfg := ini.Empty()</span><br></pre></td></tr></table></figure>
<p>当您在一开始无法决定需要加载哪些数据源时，仍可以使用 <strong>Append()</strong> 在需要的时候加载它们。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err := cfg.Append(<span class="string">"other file"</span>, []<span class="keyword">byte</span>(<span class="string">"other raw data"</span>))</span><br></pre></td></tr></table></figure>
<p>当您想要加载一系列文件，但是不能够确定其中哪些文件是不存在的，可以通过调用函数 <code>LooseLoad</code> 来忽略它们（<code>Load</code> 会因为文件不存在而返回错误）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfg, err := ini.LooseLoad(<span class="string">"filename"</span>, <span class="string">"filename_404"</span>)</span><br></pre></td></tr></table></figure>
<p>更牛逼的是，当那些之前不存在的文件在重新调用 <code>Reload</code> 方法的时候突然出现了，那么它们会被正常加载。</p>
<h4 id="忽略键名的大小写"><a href="#忽略键名的大小写" class="headerlink" title="忽略键名的大小写"></a>忽略键名的大小写</h4><p>有时候分区和键的名称大小写混合非常烦人，这个时候就可以通过 <code>InsensitiveLoad</code> 将所有分区和键名在读取里强制转换为小写：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cfg, err := ini.InsensitiveLoad(<span class="string">"filename"</span>)</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// sec1 和 sec2 指向同一个分区对象</span></span><br><span class="line">sec1, err := cfg.GetSection(<span class="string">"Section"</span>)</span><br><span class="line">sec2, err := cfg.GetSection(<span class="string">"SecTIOn"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// key1 和 key2 指向同一个键对象</span></span><br><span class="line">key1, err := sec1.GetKey(<span class="string">"Key"</span>)</span><br><span class="line">key2, err := sec2.GetKey(<span class="string">"KeY"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="类似-MySQL-配置中的布尔值键"><a href="#类似-MySQL-配置中的布尔值键" class="headerlink" title="类似 MySQL 配置中的布尔值键"></a>类似 MySQL 配置中的布尔值键</h4><p>MySQL 的配置文件中会出现没有具体值的布尔类型的键：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">...</span><br><span class="line">skip-host-cache</span><br><span class="line">skip-name-resolve</span><br></pre></td></tr></table></figure>
<p>默认情况下这被认为是缺失值而无法完成解析，但可以通过高级的加载选项对它们进行处理：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfg, err := ini.LoadSources(ini.LoadOptions&#123;AllowBooleanKeys: <span class="literal">true</span>&#125;, <span class="string">"my.cnf"</span>))</span><br></pre></td></tr></table></figure>
<p>这些键的值永远为 <code>true</code>，且在保存到文件时也只会输出键名。</p>
<p>如果您想要通过程序来生成此类键，则可以使用 <code>NewBooleanKey</code>：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key, err := sec.NewBooleanKey(<span class="string">"skip-host-cache"</span>)</span><br></pre></td></tr></table></figure>
<h4 id="关于注释"><a href="#关于注释" class="headerlink" title="关于注释"></a>关于注释</h4><p>下述几种情况的内容将被视为注释：</p>
<ol>
<li>所有以 <code>#</code> 或 <code>;</code> 开头的行</li>
<li>所有在 <code>#</code> 或 <code>;</code> 之后的内容</li>
<li>分区标签后的文字 (即 <code>[分区名]</code> 之后的内容)</li>
</ol>
<p>如果你希望使用包含 <code>#</code> 或 <code>;</code> 的值，请使用 <figure class="highlight plain"><figcaption><span>``` 或 ``` """ ``` 进行包覆。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">除此之外，您还可以通过 `LoadOptions` 完全忽略行内注释：</span><br><span class="line"></span><br><span class="line">```go</span><br><span class="line">cfg, err := ini.LoadSources(ini.LoadOptions&#123;IgnoreInlineComment: true&#125;, &quot;app.ini&quot;))</span><br></pre></td></tr></table></figure></p>
<h3 id="操作分区（Section）"><a href="#操作分区（Section）" class="headerlink" title="操作分区（Section）"></a>操作分区（Section）</h3><p>获取指定分区：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">section, err := cfg.GetSection(<span class="string">"section name"</span>)</span><br></pre></td></tr></table></figure>
<p>如果您想要获取默认分区，则可以用空字符串代替分区名：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">section, err := cfg.GetSection(<span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<p>当您非常确定某个分区是存在的，可以使用以下简便方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">section := cfg.Section(<span class="string">"section name"</span>)</span><br></pre></td></tr></table></figure>
<p>如果不小心判断错了，要获取的分区其实是不存在的，那会发生什么呢？没事的，它会自动创建并返回一个对应的分区对象给您。</p>
<p>创建一个分区：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err := cfg.NewSection(<span class="string">"new section"</span>)</span><br></pre></td></tr></table></figure>
<p>获取所有分区对象或名称：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sections := cfg.Sections()</span><br><span class="line">names := cfg.SectionStrings()</span><br></pre></td></tr></table></figure>
<h3 id="操作键（Key）"><a href="#操作键（Key）" class="headerlink" title="操作键（Key）"></a>操作键（Key）</h3><p>获取某个分区下的键：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key, err := cfg.Section(<span class="string">""</span>).GetKey(<span class="string">"key name"</span>)</span><br></pre></td></tr></table></figure>
<p>和分区一样，您也可以直接获取键而忽略错误处理：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key := cfg.Section(<span class="string">""</span>).Key(<span class="string">"key name"</span>)</span><br></pre></td></tr></table></figure>
<p>判断某个键是否存在：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yes := cfg.Section(<span class="string">""</span>).HasKey(<span class="string">"key name"</span>)</span><br></pre></td></tr></table></figure>
<p>创建一个新的键：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err := cfg.Section(<span class="string">""</span>).NewKey(<span class="string">"name"</span>, <span class="string">"value"</span>)</span><br></pre></td></tr></table></figure>
<p>获取分区下的所有键或键名：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keys := cfg.Section(<span class="string">""</span>).Keys()</span><br><span class="line">names := cfg.Section(<span class="string">""</span>).KeyStrings()</span><br></pre></td></tr></table></figure>
<p>获取分区下的所有键值对的克隆：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash := cfg.Section(<span class="string">""</span>).KeysHash()</span><br></pre></td></tr></table></figure>
<h3 id="操作键值（Value）"><a href="#操作键值（Value）" class="headerlink" title="操作键值（Value）"></a>操作键值（Value）</h3><p>获取一个类型为字符串（string）的值：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val := cfg.Section(<span class="string">""</span>).Key(<span class="string">"key name"</span>).String()</span><br></pre></td></tr></table></figure>
<p>获取值的同时通过自定义函数进行处理验证：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val := cfg.Section(<span class="string">""</span>).Key(<span class="string">"key name"</span>).Validate(<span class="function"><span class="keyword">func</span><span class="params">(in <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(in) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"default"</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> in</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果您不需要任何对值的自动转变功能（例如递归读取），可以直接获取原值（这种方式性能最佳）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val := cfg.Section(<span class="string">""</span>).Key(<span class="string">"key name"</span>).Value()</span><br></pre></td></tr></table></figure>
<p>判断某个原值是否存在：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yes := cfg.Section(<span class="string">""</span>).HasValue(<span class="string">"test value"</span>)</span><br></pre></td></tr></table></figure>
<p>获取其它类型的值：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 布尔值的规则：</span></span><br><span class="line"><span class="comment">// true 当值为：1, t, T, TRUE, true, True, YES, yes, Yes, y, ON, on, On</span></span><br><span class="line"><span class="comment">// false 当值为：0, f, F, FALSE, false, False, NO, no, No, n, OFF, off, Off</span></span><br><span class="line">v, err = cfg.Section(<span class="string">""</span>).Key(<span class="string">"BOOL"</span>).Bool()</span><br><span class="line">v, err = cfg.Section(<span class="string">""</span>).Key(<span class="string">"FLOAT64"</span>).Float64()</span><br><span class="line">v, err = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT"</span>).Int()</span><br><span class="line">v, err = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT64"</span>).Int64()</span><br><span class="line">v, err = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT"</span>).Uint()</span><br><span class="line">v, err = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT64"</span>).Uint64()</span><br><span class="line">v, err = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).TimeFormat(time.RFC3339)</span><br><span class="line">v, err = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).Time() <span class="comment">// RFC3339</span></span><br><span class="line"></span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"BOOL"</span>).MustBool()</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"FLOAT64"</span>).MustFloat64()</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT"</span>).MustInt()</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT64"</span>).MustInt64()</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT"</span>).MustUint()</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT64"</span>).MustUint64()</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).MustTimeFormat(time.RFC3339)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).MustTime() <span class="comment">// RFC3339</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 由 Must 开头的方法名允许接收一个相同类型的参数来作为默认值，</span></span><br><span class="line"><span class="comment">// 当键不存在或者转换失败时，则会直接返回该默认值。</span></span><br><span class="line"><span class="comment">// 但是，MustString 方法必须传递一个默认值。</span></span><br><span class="line"></span><br><span class="line">v = cfg.Seciont(<span class="string">""</span>).Key(<span class="string">"String"</span>).MustString(<span class="string">"default"</span>)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"BOOL"</span>).MustBool(<span class="literal">true</span>)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"FLOAT64"</span>).MustFloat64(<span class="number">1.25</span>)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT"</span>).MustInt(<span class="number">10</span>)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT64"</span>).MustInt64(<span class="number">99</span>)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT"</span>).MustUint(<span class="number">3</span>)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT64"</span>).MustUint64(<span class="number">6</span>)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).MustTimeFormat(time.RFC3339, time.Now())</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).MustTime(time.Now()) <span class="comment">// RFC3339</span></span><br></pre></td></tr></table></figure>
<p>如果我的值有好多行怎么办？</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[advance]</span></span><br><span class="line"><span class="attr">ADDRESS</span> = <span class="string">"""404 road,</span></span><br><span class="line"><span class="string">NotFound, State, 5000</span></span><br><span class="line"><span class="string">Earth"""</span></span><br></pre></td></tr></table></figure>
<p>嗯哼？小 case！</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cfg.Section(<span class="string">"advance"</span>).Key(<span class="string">"ADDRESS"</span>).String()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* --- start ---</span></span><br><span class="line"><span class="comment">404 road,</span></span><br><span class="line"><span class="comment">NotFound, State, 5000</span></span><br><span class="line"><span class="comment">Earth</span></span><br><span class="line"><span class="comment">------  end  --- */</span></span><br></pre></td></tr></table></figure>
<p>赞爆了！那要是我属于一行的内容写不下想要写到第二行怎么办？</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[advance]</span></span><br><span class="line"><span class="attr">two_lines</span> = how about \</span><br><span class="line">	continuation lines?</span><br><span class="line"><span class="attr">lots_of_lines</span> = <span class="number">1</span> \</span><br><span class="line">	2 \</span><br><span class="line">	3 \</span><br><span class="line">	4</span><br></pre></td></tr></table></figure>
<p>简直是小菜一碟！</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cfg.Section(<span class="string">"advance"</span>).Key(<span class="string">"two_lines"</span>).String() <span class="comment">// how about continuation lines?</span></span><br><span class="line">cfg.Section(<span class="string">"advance"</span>).Key(<span class="string">"lots_of_lines"</span>).String() <span class="comment">// 1 2 3 4</span></span><br></pre></td></tr></table></figure>
<p>可是我有时候觉得两行连在一起特别没劲，怎么才能不自动连接两行呢？</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfg, err := ini.LoadSources(ini.LoadOptions&#123;</span><br><span class="line">	IgnoreContinuation: <span class="literal">true</span>,</span><br><span class="line">&#125;, <span class="string">"filename"</span>)</span><br></pre></td></tr></table></figure>
<p>哇靠给力啊！</p>
<p>需要注意的是，值两侧的单引号会被自动剔除：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">foo</span> = <span class="string">"some value"</span> // foo: some value</span><br><span class="line"><span class="attr">bar</span> = <span class="string">'some value'</span> // bar: some value</span><br></pre></td></tr></table></figure>
<p>有时您会获得像从 <a href="https://crowdin.com/" target="_blank" rel="noopener">Crowdin</a> 网站下载的文件那样具有特殊格式的值（值使用双引号括起来，内部的双引号被转义）：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">create_repo</span>=<span class="string">"创建了仓库 &lt;a href=\"%s\"&gt;%s&lt;/a&gt;"</span></span><br></pre></td></tr></table></figure>
<p>那么，怎么自动地将这类值进行处理呢？</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfg, err := ini.LoadSources(ini.LoadOptions&#123;UnescapeValueDoubleQuotes: <span class="literal">true</span>&#125;, <span class="string">"en-US.ini"</span>))</span><br><span class="line">cfg.Section(<span class="string">"&lt;name of your section&gt;"</span>).Key(<span class="string">"create_repo"</span>).String() </span><br><span class="line"><span class="comment">// You got: 创建了仓库 &lt;a href="%s"&gt;%s&lt;/a&gt;</span></span><br></pre></td></tr></table></figure>
<p>这就是全部了？哈哈，当然不是。</p>
<h4 id="操作键值的辅助方法"><a href="#操作键值的辅助方法" class="headerlink" title="操作键值的辅助方法"></a>操作键值的辅助方法</h4><p>获取键值时设定候选值：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"STRING"</span>).In(<span class="string">"default"</span>, []<span class="keyword">string</span>&#123;<span class="string">"str"</span>, <span class="string">"arr"</span>, <span class="string">"types"</span>&#125;)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"FLOAT64"</span>).InFloat64(<span class="number">1.1</span>, []<span class="keyword">float64</span>&#123;<span class="number">1.25</span>, <span class="number">2.5</span>, <span class="number">3.75</span>&#125;)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT"</span>).InInt(<span class="number">5</span>, []<span class="keyword">int</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT64"</span>).InInt64(<span class="number">10</span>, []<span class="keyword">int64</span>&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT"</span>).InUint(<span class="number">4</span>, []<span class="keyword">int</span>&#123;<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>&#125;)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT64"</span>).InUint64(<span class="number">8</span>, []<span class="keyword">int64</span>&#123;<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>&#125;)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).InTimeFormat(time.RFC3339, time.Now(), []time.Time&#123;time1, time2, time3&#125;)</span><br><span class="line">v = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).InTime(time.Now(), []time.Time&#123;time1, time2, time3&#125;) <span class="comment">// RFC3339</span></span><br></pre></td></tr></table></figure>
<p>如果获取到的值不是候选值的任意一个，则会返回默认值，而默认值不需要是候选值中的一员。</p>
<p>验证获取的值是否在指定范围内：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"FLOAT64"</span>).RangeFloat64(<span class="number">0.0</span>, <span class="number">1.1</span>, <span class="number">2.2</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT"</span>).RangeInt(<span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT64"</span>).RangeInt64(<span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT"</span>).RangeUint(<span class="number">0</span>, <span class="number">3</span>, <span class="number">9</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT64"</span>).RangeUint64(<span class="number">0</span>, <span class="number">3</span>, <span class="number">9</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).RangeTimeFormat(time.RFC3339, time.Now(), minTime, maxTime)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIME"</span>).RangeTime(time.Now(), minTime, maxTime) <span class="comment">// RFC3339</span></span><br></pre></td></tr></table></figure>
<h5 id="自动分割键值到切片（slice）"><a href="#自动分割键值到切片（slice）" class="headerlink" title="自动分割键值到切片（slice）"></a>自动分割键值到切片（slice）</h5><p>当存在无效输入时，使用零值代替：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Input: 1.1, 2.2, 3.3, 4.4 -&gt; [1.1 2.2 3.3 4.4]</span></span><br><span class="line"><span class="comment">// Input: how, 2.2, are, you -&gt; [0.0 2.2 0.0 0.0]</span></span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"STRINGS"</span>).Strings(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"FLOAT64S"</span>).Float64s(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INTS"</span>).Ints(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT64S"</span>).Int64s(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINTS"</span>).Uints(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT64S"</span>).Uint64s(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIMES"</span>).Times(<span class="string">","</span>)</span><br></pre></td></tr></table></figure>
<p>从结果切片中剔除无效输入：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Input: 1.1, 2.2, 3.3, 4.4 -&gt; [1.1 2.2 3.3 4.4]</span></span><br><span class="line"><span class="comment">// Input: how, 2.2, are, you -&gt; [2.2]</span></span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"FLOAT64S"</span>).ValidFloat64s(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INTS"</span>).ValidInts(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT64S"</span>).ValidInt64s(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINTS"</span>).ValidUints(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT64S"</span>).ValidUint64s(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIMES"</span>).ValidTimes(<span class="string">","</span>)</span><br></pre></td></tr></table></figure>
<p>当存在无效输入时，直接返回错误：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Input: 1.1, 2.2, 3.3, 4.4 -&gt; [1.1 2.2 3.3 4.4]</span></span><br><span class="line"><span class="comment">// Input: how, 2.2, are, you -&gt; error</span></span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"FLOAT64S"</span>).StrictFloat64s(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INTS"</span>).StrictInts(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"INT64S"</span>).StrictInt64s(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINTS"</span>).StrictUints(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"UINT64S"</span>).StrictUint64s(<span class="string">","</span>)</span><br><span class="line">vals = cfg.Section(<span class="string">""</span>).Key(<span class="string">"TIMES"</span>).StrictTimes(<span class="string">","</span>)</span><br></pre></td></tr></table></figure>
<h3 id="保存配置"><a href="#保存配置" class="headerlink" title="保存配置"></a>保存配置</h3><p>终于到了这个时刻，是时候保存一下配置了。</p>
<p>比较原始的做法是输出配置到某个文件：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">err = cfg.SaveTo(<span class="string">"my.ini"</span>)</span><br><span class="line">err = cfg.SaveToIndent(<span class="string">"my.ini"</span>, <span class="string">"\t"</span>)</span><br></pre></td></tr></table></figure>
<p>另一个比较高级的做法是写入到任何实现 <code>io.Writer</code> 接口的对象中：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">cfg.WriteTo(writer)</span><br><span class="line">cfg.WriteToIndent(writer, <span class="string">"\t"</span>)</span><br></pre></td></tr></table></figure>
<p>默认情况下，空格将被用于对齐键值之间的等号以美化输出结果，以下代码可以禁用该功能：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini.PrettyFormat = <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><h3 id="递归读取键值"><a href="#递归读取键值" class="headerlink" title="递归读取键值"></a>递归读取键值</h3><p>在获取所有键值的过程中，特殊语法 <code>%(&lt;name&gt;)s</code> 会被应用，其中 <code>&lt;name&gt;</code> 可以是相同分区或者默认分区下的键名。字符串 <code>%(&lt;name&gt;)s</code> 会被相应的键值所替代，如果指定的键不存在，则会用空字符串替代。您可以最多使用 99 层的递归嵌套。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">NAME</span> = ini</span><br><span class="line"></span><br><span class="line"><span class="section">[author]</span></span><br><span class="line"><span class="attr">NAME</span> = Unknwon</span><br><span class="line"><span class="attr">GITHUB</span> = https://github.com/%(NAME)s</span><br><span class="line"></span><br><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">FULL_NAME</span> = github.com/go-ini/%(NAME)s</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cfg.Section(<span class="string">"author"</span>).Key(<span class="string">"GITHUB"</span>).String()		<span class="comment">// https://github.com/Unknwon</span></span><br><span class="line">cfg.Section(<span class="string">"package"</span>).Key(<span class="string">"FULL_NAME"</span>).String()	<span class="comment">// github.com/go-ini/ini</span></span><br></pre></td></tr></table></figure>
<h3 id="读取父子分区"><a href="#读取父子分区" class="headerlink" title="读取父子分区"></a>读取父子分区</h3><p>您可以在分区名称中使用 <code>.</code> 来表示两个或多个分区之间的父子关系。如果某个键在子分区中不存在，则会去它的父分区中再次寻找，直到没有父分区为止。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">NAME</span> = ini</span><br><span class="line"><span class="attr">VERSION</span> = v1</span><br><span class="line"><span class="attr">IMPORT_PATH</span> = gopkg.in/%(NAME)s.%(VERSION)s</span><br><span class="line"></span><br><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">CLONE_URL</span> = https://%(IMPORT_PATH)s</span><br><span class="line"></span><br><span class="line"><span class="section">[package.sub]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfg.Section(<span class="string">"package.sub"</span>).Key(<span class="string">"CLONE_URL"</span>).String()	<span class="comment">// https://gopkg.in/ini.v1</span></span><br></pre></td></tr></table></figure>
<h4 id="获取上级父分区下的所有键名"><a href="#获取上级父分区下的所有键名" class="headerlink" title="获取上级父分区下的所有键名"></a>获取上级父分区下的所有键名</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfg.Section(<span class="string">"package.sub"</span>).ParentKeys() <span class="comment">// ["CLONE_URL"]</span></span><br></pre></td></tr></table></figure>
<h3 id="无法解析的分区"><a href="#无法解析的分区" class="headerlink" title="无法解析的分区"></a>无法解析的分区</h3><p>如果遇到一些比较特殊的分区，它们不包含常见的键值对，而是没有固定格式的纯文本，则可以使用 <code>LoadOptions.UnparsableSections</code> 进行处理：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cfg, err := LoadSources(ini.LoadOptions&#123;UnparseableSections: []<span class="keyword">string</span>&#123;<span class="string">"COMMENTS"</span>&#125;&#125;, <span class="string">`[COMMENTS]</span></span><br><span class="line"><span class="string">&lt;1&gt;&lt;L.Slide#2&gt; This slide has the fuel listed in the wrong units &lt;e.1&gt;`</span>))</span><br><span class="line"></span><br><span class="line">body := cfg.Section(<span class="string">"COMMENTS"</span>).Body()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* --- start ---</span></span><br><span class="line"><span class="comment">&lt;1&gt;&lt;L.Slide#2&gt; This slide has the fuel listed in the wrong units &lt;e.1&gt;</span></span><br><span class="line"><span class="comment">------  end  --- */</span></span><br></pre></td></tr></table></figure>
<h3 id="读取自增键名"><a href="#读取自增键名" class="headerlink" title="读取自增键名"></a>读取自增键名</h3><p>如果数据源中的键名为 <code>-</code>，则认为该键使用了自增键名的特殊语法。计数器从 1 开始，并且分区之间是相互独立的。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[features]</span></span><br><span class="line">-: Support read/write comments of keys and sections</span><br><span class="line">-: Support auto-increment of key names</span><br><span class="line">-: Support load multiple files to overwrite key values</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfg.Section(<span class="string">"features"</span>).KeyStrings()	<span class="comment">// []&#123;"#1", "#2", "#3"&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="映射到结构"><a href="#映射到结构" class="headerlink" title="映射到结构"></a>映射到结构</h3><p>想要使用更加面向对象的方式玩转 INI 吗？好主意。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Name</span> = Unknwon</span><br><span class="line"><span class="attr">age</span> = <span class="number">21</span></span><br><span class="line"><span class="attr">Male</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">Born</span> = <span class="number">1993</span>-<span class="number">01</span>-<span class="number">01</span>T20:<span class="number">17</span>:<span class="number">05</span>Z</span><br><span class="line"></span><br><span class="line"><span class="section">[Note]</span></span><br><span class="line"><span class="attr">Content</span> = Hi is a good man!</span><br><span class="line"><span class="attr">Cities</span> = HangZhou, Boston</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Note <span class="keyword">struct</span> &#123;</span><br><span class="line">	Content <span class="keyword">string</span></span><br><span class="line">	Cities  []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span> <span class="string">`ini:"age"`</span></span><br><span class="line">	Male <span class="keyword">bool</span></span><br><span class="line">	Born time.Time</span><br><span class="line">	Note</span><br><span class="line">	Created time.Time <span class="string">`ini:"-"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cfg, err := ini.Load(<span class="string">"path/to/ini"</span>)</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	p := <span class="built_in">new</span>(Person)</span><br><span class="line">	err = cfg.MapTo(p)</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 一切竟可以如此的简单。</span></span><br><span class="line">	err = ini.MapTo(p, <span class="string">"path/to/ini"</span>)</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 嗯哼？只需要映射一个分区吗？</span></span><br><span class="line">	n := <span class="built_in">new</span>(Note)</span><br><span class="line">	err = cfg.Section(<span class="string">"Note"</span>).MapTo(n)</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结构的字段怎么设置默认值呢？很简单，只要在映射之前对指定字段进行赋值就可以了。如果键未找到或者类型错误，该值不会发生改变。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">p := &amp;Person&#123;</span><br><span class="line">	Name: <span class="string">"Joe"</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>这样玩 INI 真的好酷啊！然而，如果不能还给我原来的配置文件，有什么卵用？</p>
<h3 id="从结构反射"><a href="#从结构反射" class="headerlink" title="从结构反射"></a>从结构反射</h3><p>可是，我有说不能吗？</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Embeded <span class="keyword">struct</span> &#123;</span><br><span class="line">	Dates  []time.Time <span class="string">`delim:"|" comment:"Time data"`</span></span><br><span class="line">	Places []<span class="keyword">string</span>    <span class="string">`ini:"places,omitempty"`</span></span><br><span class="line">	None   []<span class="keyword">int</span>       <span class="string">`ini:",omitempty"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Author <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name      <span class="keyword">string</span> <span class="string">`ini:"NAME"`</span></span><br><span class="line">	Male      <span class="keyword">bool</span></span><br><span class="line">	Age       <span class="keyword">int</span> <span class="string">`comment:"Author's age"`</span></span><br><span class="line">	GPA       <span class="keyword">float64</span></span><br><span class="line">	NeverMind <span class="keyword">string</span> <span class="string">`ini:"-"`</span></span><br><span class="line">	*Embeded <span class="string">`comment:"Embeded section"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := &amp;Author&#123;<span class="string">"Unknwon"</span>, <span class="literal">true</span>, <span class="number">21</span>, <span class="number">2.8</span>, <span class="string">""</span>,</span><br><span class="line">		&amp;Embeded&#123;</span><br><span class="line">			[]time.Time&#123;time.Now(), time.Now()&#125;,</span><br><span class="line">			[]<span class="keyword">string</span>&#123;<span class="string">"HangZhou"</span>, <span class="string">"Boston"</span>&#125;,</span><br><span class="line">			[]<span class="keyword">int</span>&#123;&#125;,</span><br><span class="line">		&#125;&#125;</span><br><span class="line">	cfg := ini.Empty()</span><br><span class="line">	err = ini.ReflectFrom(cfg, a)</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>瞧瞧，奇迹发生了。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">NAME</span> = Unknwon</span><br><span class="line"><span class="attr">Male</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">; Author's age</span></span><br><span class="line"><span class="attr">Age</span> = <span class="number">21</span></span><br><span class="line"><span class="attr">GPA</span> = <span class="number">2.8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; Embeded section</span></span><br><span class="line"><span class="section">[Embeded]</span></span><br><span class="line"><span class="comment">; Time data</span></span><br><span class="line"><span class="attr">Dates</span> = <span class="number">2015</span>-<span class="number">08</span>-<span class="number">07</span>T22:<span class="number">14</span>:<span class="number">22</span>+<span class="number">08</span>:<span class="number">00</span>|<span class="number">2015</span>-<span class="number">08</span>-<span class="number">07</span>T22:<span class="number">14</span>:<span class="number">22</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="attr">places</span> = HangZhou,Boston</span><br></pre></td></tr></table></figure>
<h4 id="名称映射器（Name-Mapper）"><a href="#名称映射器（Name-Mapper）" class="headerlink" title="名称映射器（Name Mapper）"></a>名称映射器（Name Mapper）</h4><p>为了节省您的时间并简化代码，本库支持类型为 <a href="https://gowalker.org/gopkg.in/ini.v1#NameMapper" target="_blank" rel="noopener"><code>NameMapper</code></a> 的名称映射器，该映射器负责结构字段名与分区名和键名之间的映射。</p>
<p>目前有 2 款内置的映射器：</p>
<ul>
<li><code>AllCapsUnderscore</code>：该映射器将字段名转换至格式 <code>ALL_CAPS_UNDERSCORE</code> 后再去匹配分区名和键名。</li>
<li><code>TitleUnderscore</code>：该映射器将字段名转换至格式 <code>title_underscore</code> 后再去匹配分区名和键名。</li>
</ul>
<p>使用方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Info <span class="keyword">struct</span>&#123;</span><br><span class="line">	PackageName <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	err = ini.MapToWithMapper(&amp;Info&#123;&#125;, ini.TitleUnderscore, []<span class="keyword">byte</span>(<span class="string">"package_name=ini"</span>))</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">	cfg, err := ini.Load([]<span class="keyword">byte</span>(<span class="string">"PACKAGE_NAME=ini"</span>))</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	info := <span class="built_in">new</span>(Info)</span><br><span class="line">	cfg.NameMapper = ini.AllCapsUnderscore</span><br><span class="line">	err = cfg.MapTo(info)</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用函数 <code>ini.ReflectFromWithMapper</code> 时也可应用相同的规则。</p>
<h4 id="值映射器（Value-Mapper）"><a href="#值映射器（Value-Mapper）" class="headerlink" title="值映射器（Value Mapper）"></a>值映射器（Value Mapper）</h4><p>值映射器允许使用一个自定义函数自动展开值的具体内容，例如：运行时获取环境变量：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Env <span class="keyword">struct</span> &#123;</span><br><span class="line">	Foo <span class="keyword">string</span> <span class="string">`ini:"foo"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cfg, err := ini.Load([]<span class="keyword">byte</span>(<span class="string">"[env]\nfoo = $&#123;MY_VAR&#125;\n"</span>)</span><br><span class="line">	cfg.ValueMapper = os.ExpandEnv</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">	env := &amp;Env&#123;&#125;</span><br><span class="line">	err = cfg.Section(<span class="string">"env"</span>).MapTo(env)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>本例中，<code>env.Foo</code> 将会是运行时所获取到环境变量 <code>MY_VAR</code> 的值。</p>
<h4 id="映射-反射的其它说明"><a href="#映射-反射的其它说明" class="headerlink" title="映射/反射的其它说明"></a>映射/反射的其它说明</h4><p>任何嵌入的结构都会被默认认作一个不同的分区，并且不会自动产生所谓的父子分区关联：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Child <span class="keyword">struct</span> &#123;</span><br><span class="line">	Age <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Parent <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Child</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> &#123;</span><br><span class="line">	City <span class="keyword">string</span></span><br><span class="line">	Parent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例配置文件：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">City</span> = Boston</span><br><span class="line"></span><br><span class="line"><span class="section">[Parent]</span></span><br><span class="line"><span class="attr">Name</span> = Unknwon</span><br><span class="line"></span><br><span class="line"><span class="section">[Child]</span></span><br><span class="line"><span class="attr">Age</span> = <span class="number">21</span></span><br></pre></td></tr></table></figure>
<p>很好，但是，我就是要嵌入结构也在同一个分区。好吧，你爹是李刚！</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Child <span class="keyword">struct</span> &#123;</span><br><span class="line">	Age <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Parent <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Child <span class="string">`ini:"Parent"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> &#123;</span><br><span class="line">	City <span class="keyword">string</span></span><br><span class="line">	Parent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例配置文件：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">City</span> = Boston</span><br><span class="line"></span><br><span class="line"><span class="section">[Parent]</span></span><br><span class="line"><span class="attr">Name</span> = Unknwon</span><br><span class="line"><span class="attr">Age</span> = <span class="number">21</span></span><br></pre></td></tr></table></figure>
<h2 id="获取帮助"><a href="#获取帮助" class="headerlink" title="获取帮助"></a>获取帮助</h2><ul>
<li><a href="https://gowalker.org/gopkg.in/ini.v1" target="_blank" rel="noopener">API 文档</a></li>
<li><a href="https://github.com/go-ini/ini/issues/new" target="_blank" rel="noopener">创建工单</a></li>
</ul>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="字段-BlockMode-是什么？"><a href="#字段-BlockMode-是什么？" class="headerlink" title="字段 BlockMode 是什么？"></a>字段 <code>BlockMode</code> 是什么？</h3><p>默认情况下，本库会在您进行读写操作时采用锁机制来确保数据时间。但在某些情况下，您非常确定只进行读操作。此时，您可以通过设置 <code>cfg.BlockMode = false</code> 来将读操作提升大约 <strong>50-70%</strong> 的性能。</p>
<h3 id="为什么要写另一个-INI-解析库？"><a href="#为什么要写另一个-INI-解析库？" class="headerlink" title="为什么要写另一个 INI 解析库？"></a>为什么要写另一个 INI 解析库？</h3><p>许多人都在使用我的 <a href="https://github.com/Unknwon/goconfig" target="_blank" rel="noopener">goconfig</a> 来完成对 INI 文件的操作，但我希望使用更加 Go 风格的代码。并且当您设置 <code>cfg.BlockMode = false</code> 时，会有大约 <strong>10-30%</strong> 的性能提升。</p>
<p>为了做出这些改变，我必须对 API 进行破坏，所以新开一个仓库是最安全的做法。除此之外，本库直接使用 <code>gopkg.in</code> 来进行版本化发布。（其实真相是导入路径更短了）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhanghongtong.github.io/2018/05/14/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张奇怪">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张奇怪的blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/14/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-14T14:46:13+08:00">
                2018-05-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="张奇怪" />
          <p class="site-author-name" itemprop="name">张奇怪</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张奇怪</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
